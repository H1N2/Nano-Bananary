# Nano Bananary å¼€å‘æŒ‡å—

## 1. å¼€å‘ç¯å¢ƒæ­å»º

### 1.1 ç³»ç»Ÿè¦æ±‚

#### 1.1.1 åŸºç¡€ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **Node.js**: ç‰ˆæœ¬ 18.0.0 æˆ–æ›´é«˜
- **npm**: ç‰ˆæœ¬ 8.0.0 æˆ–æ›´é«˜ï¼ˆéšNode.jså®‰è£…ï¼‰
- **Git**: ç‰ˆæœ¬ 2.20.0 æˆ–æ›´é«˜

#### 1.1.2 æ¨èå·¥å…·
- **IDE**: Visual Studio Code
- **æµè§ˆå™¨**: Chrome 90+, Firefox 88+, Safari 14+
- **ç»ˆç«¯**: Windows Terminal, iTerm2, æˆ–ç³»ç»Ÿé»˜è®¤ç»ˆç«¯

### 1.2 ç¯å¢ƒå®‰è£…

#### 1.2.1 Node.js å®‰è£…
```bash
# æ–¹å¼1: ä»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…
# è®¿é—® https://nodejs.org/ ä¸‹è½½LTSç‰ˆæœ¬

# æ–¹å¼2: ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼ˆæ¨èï¼‰
# Windows (ä½¿ç”¨ Chocolatey)
choco install nodejs

# macOS (ä½¿ç”¨ Homebrew)
brew install node

# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version
```

#### 1.2.2 Git å®‰è£…
```bash
# Windows
# ä» https://git-scm.com/ ä¸‹è½½å®‰è£…åŒ…

# macOS
brew install git

# Ubuntu/Debian
sudo apt-get install git

# éªŒè¯å®‰è£…
git --version
```

### 1.3 é¡¹ç›®å…‹éš†å’Œåˆå§‹åŒ–

#### 1.3.1 å…‹éš†é¡¹ç›®
```bash
# å…‹éš†é¡¹ç›®ä»“åº“
git clone https://github.com/your-username/Nano-Bananary.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd Nano-Bananary
```

#### 1.3.2 å®‰è£…ä¾èµ–
```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm install

# æˆ–ä½¿ç”¨ yarnï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
yarn install
```

#### 1.3.3 ç¯å¢ƒå˜é‡é…ç½®
```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ å¿…è¦çš„é…ç½®
# API_KEY=your_google_gemini_api_key_here
```

### 1.4 å¼€å‘å·¥å…·é…ç½®

#### 1.4.1 VS Code é…ç½®

**æ¨èæ‰©å±•**:
```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json"
  ]
}
```

**å·¥ä½œåŒºè®¾ç½®** (`.vscode/settings.json`):
```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "files.associations": {
    "*.tsx": "typescriptreact"
  }
}
```

#### 1.4.2 ä»£ç æ ¼å¼åŒ–é…ç½®

**Prettier é…ç½®** (`.prettierrc`):
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

**ESLint é…ç½®** (`.eslintrc.js`):
```javascript
module.exports = {
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended'
  ],
  parser: '@typescript-eslint/parser',
  plugins: ['@typescript-eslint', 'react', 'react-hooks'],
  rules: {
    'react/react-in-jsx-scope': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/no-explicit-any': 'warn'
  },
  settings: {
    react: {
      version: 'detect'
    }
  }
};
```

## 2. é¡¹ç›®ç»“æ„è¯¦è§£

### 2.1 ç›®å½•ç»“æ„
```
Nano-Bananary/
â”œâ”€â”€ public/                 # é™æ€èµ„æºç›®å½•
â”‚   â”œâ”€â”€ index.html         # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ favicon.ico        # ç½‘ç«™å›¾æ ‡
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ components/        # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ AspectRatioSelector.tsx
â”‚   â”‚   â”œâ”€â”€ ErrorMessage.tsx
â”‚   â”‚   â”œâ”€â”€ HistoryPanel.tsx
â”‚   â”‚   â”œâ”€â”€ ImageEditorCanvas.tsx
â”‚   â”‚   â”œâ”€â”€ ImagePreviewModal.tsx
â”‚   â”‚   â”œâ”€â”€ ImageUploader.tsx
â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚   â”œâ”€â”€ MultiImageUploader.tsx
â”‚   â”‚   â”œâ”€â”€ OutputSizeSelector.tsx
â”‚   â”‚   â”œâ”€â”€ PromptSelector.tsx
â”‚   â”‚   â”œâ”€â”€ ResultDisplay.tsx
â”‚   â”‚   â””â”€â”€ TransformationSelector.tsx
â”‚   â”œâ”€â”€ services/          # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ geminiService.ts
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ fileUtils.ts
â”‚   â”œâ”€â”€ App.tsx            # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ constants.ts       # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ index.tsx          # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ types.ts           # ç±»å‹å®šä¹‰
â”œâ”€â”€ doc/                   # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ éœ€æ±‚åˆ†ææ–‡æ¡£.md
â”‚   â”œâ”€â”€ æŠ€æœ¯è®¾è®¡æ–‡æ¡£.md
â”‚   â”œâ”€â”€ ç³»ç»Ÿæ¶æ„è¯´æ˜.md
â”‚   â”œâ”€â”€ APIæ¥å£æ–‡æ¡£.md
â”‚   â””â”€â”€ å¼€å‘æŒ‡å—.md
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore            # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ package.json          # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json         # TypeScripté…ç½®
â”œâ”€â”€ vite.config.ts        # Viteæ„å»ºé…ç½®
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

### 2.2 æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

#### 2.2.1 é…ç½®æ–‡ä»¶

**package.json** - é¡¹ç›®ä¾èµ–å’Œè„šæœ¬é…ç½®:
```json
{
  "name": "ğŸŒ-nano-bananaryï½œzho",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "@google/genai": "^1.17.0"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}
```

**tsconfig.json** - TypeScriptç¼–è¯‘é…ç½®:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"],
  "references": [{"path": "./tsconfig.node.json"}]
}
```

**vite.config.ts** - Viteæ„å»ºé…ç½®:
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  define: {
    'process.env': process.env
  },
  server: {
    port: 3000,
    open: true
  },
  build: {
    outDir: 'dist',
    sourcemap: true
  }
})
```

## 3. å¼€å‘æµç¨‹

### 3.1 æ—¥å¸¸å¼€å‘æµç¨‹

#### 3.1.1 å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æˆ–ä½¿ç”¨ yarn
yarn dev

# æœåŠ¡å™¨å°†åœ¨ http://localhost:3000 å¯åŠ¨
```

#### 3.1.2 ä»£ç å¼€å‘æµç¨‹
1. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
   ```bash
   git checkout -b feature/new-transformation
   ```

2. **ç¼–å†™ä»£ç **
   - éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
   - æ·»åŠ å¿…è¦çš„ç±»å‹å®šä¹‰
   - ç¼–å†™å‡½æ•°çº§æ³¨é‡Š

3. **æµ‹è¯•åŠŸèƒ½**
   ```bash
   # ç±»å‹æ£€æŸ¥
   npm run type-check
   
   # ä»£ç æ£€æŸ¥
   npm run lint
   
   # æ‰‹åŠ¨æµ‹è¯•åŠŸèƒ½
   npm run dev
   ```

4. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "feat: add new transformation feature"
   git push origin feature/new-transformation
   ```

### 3.2 ç»„ä»¶å¼€å‘è§„èŒƒ

#### 3.2.1 ç»„ä»¶æ–‡ä»¶ç»“æ„
```typescript
// ComponentName.tsx
import React, { useState, useCallback } from 'react';

// ç±»å‹å®šä¹‰
interface ComponentNameProps {
  // å±æ€§å®šä¹‰
  title: string;
  onAction: (data: any) => void;
}

/**
 * ç»„ä»¶åŠŸèƒ½æè¿°
 * @param props ç»„ä»¶å±æ€§
 * @returns JSXå…ƒç´ 
 */
const ComponentName: React.FC<ComponentNameProps> = ({ title, onAction }) => {
  // çŠ¶æ€å®šä¹‰
  const [localState, setLocalState] = useState<string>('');
  
  // äº‹ä»¶å¤„ç†å‡½æ•°
  const handleClick = useCallback(() => {
    onAction({ data: localState });
  }, [localState, onAction]);
  
  // æ¸²æŸ“
  return (
    <div className="component-container">
      <h2>{title}</h2>
      <button onClick={handleClick}>Action</button>
    </div>
  );
};

export default ComponentName;
```

#### 3.2.2 ç»„ä»¶å‘½åè§„èŒƒ
- **æ–‡ä»¶å**: ä½¿ç”¨PascalCaseï¼Œå¦‚ `ImageUploader.tsx`
- **ç»„ä»¶å**: ä¸æ–‡ä»¶åä¿æŒä¸€è‡´
- **Propsæ¥å£**: ç»„ä»¶å + Propsï¼Œå¦‚ `ImageUploaderProps`
- **äº‹ä»¶å¤„ç†å‡½æ•°**: handle + åŠ¨ä½œï¼Œå¦‚ `handleImageUpload`

#### 3.2.3 çŠ¶æ€ç®¡ç†è§„èŒƒ
```typescript
// ç®€å•çŠ¶æ€
const [isLoading, setIsLoading] = useState<boolean>(false);

// å¤æ‚çŠ¶æ€ä½¿ç”¨useReducer
interface State {
  data: any[];
  loading: boolean;
  error: string | null;
}

type Action = 
  | { type: 'FETCH_START' }
  | { type: 'FETCH_SUCCESS'; payload: any[] }
  | { type: 'FETCH_ERROR'; payload: string };

const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'FETCH_START':
      return { ...state, loading: true, error: null };
    case 'FETCH_SUCCESS':
      return { ...state, loading: false, data: action.payload };
    case 'FETCH_ERROR':
      return { ...state, loading: false, error: action.payload };
    default:
      return state;
  }
};

const [state, dispatch] = useReducer(reducer, initialState);
```

### 3.3 æœåŠ¡å¼€å‘è§„èŒƒ

#### 3.3.1 æœåŠ¡æ–‡ä»¶ç»“æ„
```typescript
// serviceName.ts

/**
 * æœåŠ¡åŠŸèƒ½æè¿°
 */

// ç±»å‹å¯¼å…¥
import type { RequestType, ResponseType } from '../types';

/**
 * ä¸»è¦æœåŠ¡å‡½æ•°
 * @param param1 å‚æ•°1æè¿°
 * @param param2 å‚æ•°2æè¿°
 * @returns è¿”å›å€¼æè¿°
 */
export async function serviceFunction(
  param1: string,
  param2: number
): Promise<ResponseType> {
  try {
    // å®ç°é€»è¾‘
    const result = await performOperation(param1, param2);
    return result;
  } catch (error) {
    console.error('Service error:', error);
    throw new Error(`Service operation failed: ${error.message}`);
  }
}

/**
 * è¾…åŠ©å‡½æ•°
 */
function performOperation(param1: string, param2: number): Promise<any> {
  // å®ç°ç»†èŠ‚
}
```

#### 3.3.2 é”™è¯¯å¤„ç†è§„èŒƒ
```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
export class ServiceError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode?: number
  ) {
    super(message);
    this.name = 'ServiceError';
  }
}

// é”™è¯¯å¤„ç†å‡½æ•°
export function handleServiceError(error: any): ServiceError {
  if (error instanceof ServiceError) {
    return error;
  }
  
  // æ ¹æ®é”™è¯¯ç±»å‹è¿›è¡Œåˆ†ç±»å¤„ç†
  if (error.status === 401) {
    return new ServiceError('Authentication failed', 'AUTH_ERROR', 401);
  }
  
  if (error.status === 429) {
    return new ServiceError('Rate limit exceeded', 'RATE_LIMIT', 429);
  }
  
  return new ServiceError(
    error.message || 'Unknown service error',
    'UNKNOWN_ERROR'
  );
}
```

## 4. è°ƒè¯•å’Œæµ‹è¯•

### 4.1 å¼€å‘è°ƒè¯•

#### 4.1.1 æµè§ˆå™¨å¼€å‘è€…å·¥å…·
```typescript
// è°ƒè¯•æ—¥å¿—
console.log('Debug info:', { data, state });
console.warn('Warning:', warningMessage);
console.error('Error:', error);

// æ€§èƒ½æµ‹è¯•
console.time('operation');
// æ‰§è¡Œæ“ä½œ
console.timeEnd('operation');

// æ–­ç‚¹è°ƒè¯•
debugger; // åœ¨æ­¤å¤„æš‚åœæ‰§è¡Œ
```

#### 4.1.2 React Developer Tools
```bash
# å®‰è£…Reactå¼€å‘è€…å·¥å…·æµè§ˆå™¨æ‰©å±•
# Chrome: https://chrome.google.com/webstore/detail/react-developer-tools/
# Firefox: https://addons.mozilla.org/en-US/firefox/addon/react-devtools/
```

#### 4.1.3 ç½‘ç»œè¯·æ±‚è°ƒè¯•
```typescript
// åœ¨æœåŠ¡å‡½æ•°ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯
export async function editImage(
  base64ImageData: string,
  mimeType: string,
  prompt: string,
  maskBase64: string | null = null,
  secondaryImage: { base64: string; mimeType: string } | null = null
): Promise<GeneratedContent> {
  // è°ƒè¯•ä¿¡æ¯
  console.log('API Request:', {
    imageSize: base64ImageData.length,
    mimeType,
    prompt: prompt.substring(0, 100) + '...',
    hasMask: !!maskBase64,
    hasSecondaryImage: !!secondaryImage
  });
  
  const startTime = performance.now();
  
  try {
    const result = await performAPICall(/* parameters */);
    
    console.log('API Success:', {
      duration: performance.now() - startTime,
      resultType: typeof result
    });
    
    return result;
  } catch (error) {
    console.error('API Error:', {
      duration: performance.now() - startTime,
      error: error.message
    });
    throw error;
  }
}
```

### 4.2 å•å…ƒæµ‹è¯•

#### 4.2.1 æµ‹è¯•ç¯å¢ƒé…ç½®
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
npm install --save-dev jest @testing-library/react @testing-library/jest-dom

# æˆ–ä½¿ç”¨ yarn
yarn add --dev jest @testing-library/react @testing-library/jest-dom
```

#### 4.2.2 æµ‹è¯•æ–‡ä»¶ç¤ºä¾‹
```typescript
// ComponentName.test.tsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import '@testing-library/jest-dom';
import ComponentName from './ComponentName';

describe('ComponentName', () => {
  test('renders correctly', () => {
    render(<ComponentName title="Test Title" onAction={jest.fn()} />);
    expect(screen.getByText('Test Title')).toBeInTheDocument();
  });
  
  test('handles click event', () => {
    const mockOnAction = jest.fn();
    render(<ComponentName title="Test" onAction={mockOnAction} />);
    
    fireEvent.click(screen.getByText('Action'));
    expect(mockOnAction).toHaveBeenCalled();
  });
});
```

#### 4.2.3 æœåŠ¡æµ‹è¯•ç¤ºä¾‹
```typescript
// serviceName.test.ts
import { serviceFunction } from './serviceName';

// Mockå¤–éƒ¨ä¾èµ–
jest.mock('./externalDependency');

describe('serviceFunction', () => {
  test('should return expected result', async () => {
    const result = await serviceFunction('test', 123);
    expect(result).toBeDefined();
    expect(result.success).toBe(true);
  });
  
  test('should handle errors gracefully', async () => {
    // æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µ
    await expect(serviceFunction('', -1))
      .rejects.toThrow('Invalid parameters');
  });
});
```

### 4.3 ç«¯åˆ°ç«¯æµ‹è¯•

#### 4.3.1 Cypressé…ç½®
```bash
# å®‰è£…Cypress
npm install --save-dev cypress

# åˆå§‹åŒ–Cypress
npx cypress open
```

#### 4.3.2 E2Eæµ‹è¯•ç¤ºä¾‹
```typescript
// cypress/e2e/image-processing.cy.ts
describe('Image Processing Flow', () => {
  beforeEach(() => {
    cy.visit('/');
  });
  
  it('should process image successfully', () => {
    // é€‰æ‹©å˜æ¢
    cy.get('[data-testid="transformation-3d-figurine"]').click();
    
    // ä¸Šä¼ å›¾åƒ
    cy.get('input[type="file"]').selectFile('cypress/fixtures/test-image.jpg');
    
    // ç‚¹å‡»ç”Ÿæˆ
    cy.get('[data-testid="generate-button"]').click();
    
    // éªŒè¯ç»“æœ
    cy.get('[data-testid="result-image"]', { timeout: 30000 })
      .should('be.visible');
  });
});
```

## 5. æ„å»ºå’Œéƒ¨ç½²

### 5.1 æœ¬åœ°æ„å»º

#### 5.1.1 æ„å»ºå‘½ä»¤
```bash
# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

#### 5.1.2 æ„å»ºä¼˜åŒ–
```typescript
// vite.config.ts - æ„å»ºä¼˜åŒ–é…ç½®
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          ai: ['@google/genai']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  define: {
    'process.env': process.env
  }
});
```

### 5.2 éƒ¨ç½²é…ç½®

#### 5.2.1 é™æ€éƒ¨ç½²ï¼ˆNetlify/Vercelï¼‰
```bash
# æ„å»ºé¡¹ç›®
npm run build

# éƒ¨ç½²åˆ°Netlify
# 1. å°†distç›®å½•ä¸Šä¼ åˆ°Netlify
# 2. é…ç½®ç¯å¢ƒå˜é‡
# 3. è®¾ç½®é‡å®šå‘è§„åˆ™
```

**netlify.toml** é…ç½®:
```toml
[build]
  publish = "dist"
  command = "npm run build"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "18"
```

#### 5.2.2 Dockeréƒ¨ç½²
```dockerfile
# Dockerfile
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**nginx.conf** é…ç½®:
```nginx
server {
    listen 80;
    server_name localhost;
    
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 ä»£ç ä¼˜åŒ–

#### 6.1.1 ç»„ä»¶ä¼˜åŒ–
```typescript
// ä½¿ç”¨React.memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const OptimizedComponent = React.memo<ComponentProps>(({ data, onAction }) => {
  // ç»„ä»¶å®ç°
}, (prevProps, nextProps) => {
  // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
  return prevProps.data.id === nextProps.data.id;
});

// ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°
const handleClick = useCallback((id: string) => {
  onAction(id);
}, [onAction]);

// ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);
```

#### 6.1.2 æ‡’åŠ è½½
```typescript
// ç»„ä»¶æ‡’åŠ è½½
const LazyComponent = React.lazy(() => import('./LazyComponent'));

// åœ¨ä½¿ç”¨æ—¶åŒ…è£…Suspense
<Suspense fallback={<LoadingSpinner />}>
  <LazyComponent />
</Suspense>

// å›¾åƒæ‡’åŠ è½½
const LazyImage: React.FC<{ src: string; alt: string }> = ({ src, alt }) => {
  const [isLoaded, setIsLoaded] = useState(false);
  const [isInView, setIsInView] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsInView(true);
          observer.disconnect();
        }
      },
      { threshold: 0.1 }
    );
    
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    return () => observer.disconnect();
  }, []);
  
  return (
    <img
      ref={imgRef}
      src={isInView ? src : undefined}
      alt={alt}
      onLoad={() => setIsLoaded(true)}
      style={{ opacity: isLoaded ? 1 : 0 }}
    />
  );
};
```

### 6.2 ç½‘ç»œä¼˜åŒ–

#### 6.2.1 å›¾åƒå‹ç¼©
```typescript
/**
 * å‹ç¼©å›¾åƒæ–‡ä»¶
 * @param file åŸå§‹æ–‡ä»¶
 * @param maxWidth æœ€å¤§å®½åº¦
 * @param quality å‹ç¼©è´¨é‡ (0-1)
 * @returns å‹ç¼©åçš„DataURL
 */
export function compressImage(
  file: File,
  maxWidth: number = 1024,
  quality: number = 0.8
): Promise<string> {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d')!;
    const img = new Image();
    
    img.onload = () => {
      const { width, height } = img;
      const scale = Math.min(maxWidth / width, maxWidth / height, 1);
      
      canvas.width = width * scale;
      canvas.height = height * scale;
      
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      
      const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
      resolve(compressedDataUrl);
    };
    
    img.src = URL.createObjectURL(file);
  });
}
```

#### 6.2.2 è¯·æ±‚ä¼˜åŒ–
```typescript
// è¯·æ±‚å»é‡
const requestCache = new Map<string, Promise<any>>();

export function deduplicateRequest<T>(
  key: string,
  requestFn: () => Promise<T>
): Promise<T> {
  if (requestCache.has(key)) {
    return requestCache.get(key)!;
  }
  
  const request = requestFn().finally(() => {
    requestCache.delete(key);
  });
  
  requestCache.set(key, request);
  return request;
}

// ä½¿ç”¨ç¤ºä¾‹
const processImage = (imageData: string, prompt: string) => {
  const cacheKey = `${imageData.substring(0, 50)}-${prompt}`;
  return deduplicateRequest(cacheKey, () => 
    editImage(imageData, 'image/jpeg', prompt)
  );
};
```

## 7. æ•…éšœæ’é™¤

### 7.1 å¸¸è§é—®é¢˜

#### 7.1.1 ç¯å¢ƒé—®é¢˜

**é—®é¢˜**: Node.jsç‰ˆæœ¬ä¸å…¼å®¹
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version

# å¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œå‡çº§Node.js
# ä½¿ç”¨nvmç®¡ç†Node.jsç‰ˆæœ¬
nvm install 18
nvm use 18
```

**é—®é¢˜**: ä¾èµ–å®‰è£…å¤±è´¥
```bash
# æ¸…é™¤npmç¼“å­˜
npm cache clean --force

# åˆ é™¤node_moduleså’Œpackage-lock.json
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…
npm install
```

#### 7.1.2 APIé—®é¢˜

**é—®é¢˜**: APIå¯†é’¥æ— æ•ˆ
```typescript
// æ£€æŸ¥APIå¯†é’¥é…ç½®
if (!process.env.API_KEY) {
  console.error('API_KEY environment variable is not set');
  // æ£€æŸ¥.envæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
}

// éªŒè¯APIå¯†é’¥æ ¼å¼
const apiKey = process.env.API_KEY;
if (!apiKey || !apiKey.startsWith('AIza')) {
  console.error('Invalid API key format');
}
```

**é—®é¢˜**: APIè°ƒç”¨å¤±è´¥
```typescript
// æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
try {
  const result = await editImage(imageData, mimeType, prompt);
} catch (error) {
  console.error('API Error Details:', {
    message: error.message,
    status: error.status,
    response: error.response
  });
  
  // æ ¹æ®é”™è¯¯ç±»å‹æä¾›è§£å†³å»ºè®®
  if (error.status === 429) {
    console.log('Rate limit exceeded. Wait and retry.');
  } else if (error.status === 401) {
    console.log('Check API key configuration.');
  }
}
```

#### 7.1.3 æ„å»ºé—®é¢˜

**é—®é¢˜**: TypeScriptç¼–è¯‘é”™è¯¯
```bash
# æ£€æŸ¥TypeScripté…ç½®
npx tsc --noEmit

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
npx tsc --noEmit --listFiles
```

**é—®é¢˜**: æ„å»ºå†…å­˜ä¸è¶³
```bash
# å¢åŠ Node.jså†…å­˜é™åˆ¶
NODE_OPTIONS="--max-old-space-size=4096" npm run build
```

### 7.2 è°ƒè¯•æŠ€å·§

#### 7.2.1 æ€§èƒ½åˆ†æ
```typescript
// æ€§èƒ½ç›‘æ§
const performanceMonitor = {
  start: (label: string) => {
    console.time(label);
    performance.mark(`${label}-start`);
  },
  
  end: (label: string) => {
    console.timeEnd(label);
    performance.mark(`${label}-end`);
    performance.measure(label, `${label}-start`, `${label}-end`);
  },
  
  getMetrics: () => {
    return performance.getEntriesByType('measure');
  }
};

// ä½¿ç”¨ç¤ºä¾‹
performanceMonitor.start('image-processing');
await processImage(imageData);
performanceMonitor.end('image-processing');
```

#### 7.2.2 å†…å­˜æ³„æ¼æ£€æµ‹
```typescript
// ç›‘æ§ç»„ä»¶æŒ‚è½½å’Œå¸è½½
const useComponentLifecycle = (componentName: string) => {
  useEffect(() => {
    console.log(`${componentName} mounted`);
    return () => {
      console.log(`${componentName} unmounted`);
    };
  }, [componentName]);
};

// æ¸…ç†å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨
const useCleanup = () => {
  const timeoutsRef = useRef<NodeJS.Timeout[]>([]);
  const intervalsRef = useRef<NodeJS.Timeout[]>([]);
  
  const setTimeout = (callback: () => void, delay: number) => {
    const id = window.setTimeout(callback, delay);
    timeoutsRef.current.push(id);
    return id;
  };
  
  useEffect(() => {
    return () => {
      timeoutsRef.current.forEach(clearTimeout);
      intervalsRef.current.forEach(clearInterval);
    };
  }, []);
  
  return { setTimeout };
};
```

## 8. è´¡çŒ®æŒ‡å—

### 8.1 ä»£ç è´¡çŒ®æµç¨‹

1. **Forké¡¹ç›®**
   ```bash
   # åœ¨GitHubä¸ŠForké¡¹ç›®
   # å…‹éš†ä½ çš„Fork
   git clone https://github.com/your-username/Nano-Bananary.git
   ```

2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
   ```bash
   git checkout -b feature/your-feature-name
   ```

3. **å¼€å‘å’Œæµ‹è¯•**
   ```bash
   # å¼€å‘åŠŸèƒ½
   # è¿è¡Œæµ‹è¯•
   npm run test
   npm run type-check
   npm run lint
   ```

4. **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "feat: add your feature description"
   git push origin feature/your-feature-name
   ```

5. **åˆ›å»ºPull Request**
   - åœ¨GitHubä¸Šåˆ›å»ºPR
   - å¡«å†™è¯¦ç»†çš„æè¿°
   - ç­‰å¾…ä»£ç å®¡æŸ¥

### 8.2 æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨[Conventional Commits](https://www.conventionalcommits.org/)è§„èŒƒ:

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**ç±»å‹è¯´æ˜**:
- `feat`: æ–°åŠŸèƒ½
- `fix`: é”™è¯¯ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºæˆ–å·¥å…·ç›¸å…³

**ç¤ºä¾‹**:
```bash
git commit -m "feat(components): add image compression feature"
git commit -m "fix(api): handle rate limit errors properly"
git commit -m "docs: update development guide"
```

### 8.3 ä»£ç å®¡æŸ¥æ ‡å‡†

- **åŠŸèƒ½å®Œæ•´æ€§**: åŠŸèƒ½æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ
- **ä»£ç è´¨é‡**: ä»£ç æ˜¯å¦æ¸…æ™°ã€å¯ç»´æŠ¤
- **æ€§èƒ½å½±å“**: æ˜¯å¦å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“
- **æµ‹è¯•è¦†ç›–**: æ˜¯å¦åŒ…å«é€‚å½“çš„æµ‹è¯•
- **æ–‡æ¡£æ›´æ–°**: æ˜¯å¦æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- **å‘åå…¼å®¹**: æ˜¯å¦ç ´åç°æœ‰åŠŸèƒ½

---

æœ¬å¼€å‘æŒ‡å—å°†éšç€é¡¹ç›®çš„å‘å±•æŒç»­æ›´æ–°ã€‚å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·åœ¨é¡¹ç›®çš„GitHubä»“åº“ä¸­åˆ›å»ºIssueæˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚